\NeedsTeXFormat{LaTeX2e}[1999/01/01]
\ProvidesPackage{nntikz}[2018/09/25]

\RequirePackage{ifthen}
\RequirePackage{xargs}
\RequirePackage{xparse}
\RequirePackage{tikz}
\usetikzlibrary{calc,shapes,arrows}
\usetikzlibrary{decorations.pathreplacing,decorations.markings}

% macros tracers des graphes de réseau de neurones
% version 1.0

\def\yoff{1.5}

\tikzstyle{neuron}=[thick,draw,circle,minimum size=20pt,inner sep=0pt]
\newcommand{\neuron}[1]{
\tikzstyle{neuron}+=[#1]
}

\newcommandx{\nninput}[3][2=1,3=green]
{
	\def\dim{#2}
	\def\dimd{\numexpr\dim-1}
	\pgfmathtruncatemacro{\dimi}{\dim-1}
	\node (#1) at (\dim,\dim) {#1};
	\foreach \xn in {0,...,\dimi} {
		\pgfmathsetmacro{\y}{\yoff*\xn-(\dim-1)*\yoff/2}
		\node[neuron,fill=#3!50] (#1-\xn) at (0,\y) {$x_\xn$};
		}
}
\newcommandx{\nnoutput}[4][2=1,3=0,4=red]
{
	\def\xoff{#3}
	\def\dim{#2}
	\def\dimd{\numexpr\dim-1}
	\node (#1) at (\dim,\dim) {#1};
	\foreach \xn in {0,...,\dimd} {
		\pgfmathsetmacro{\y}{\yoff*\xn-(\dim-1)*\yoff/2}
		\node[neuron,fill=#4!50] (#1-\xn) at (\xoff,\y) {$y_\xn$};
		}
}
\newcommandx{\nnhidden}[4][2=1,3=,4=blue]
{
	\def\xoff{#3}
	\def\dim{#2}
	\node (#1) at (\dim pt,\dim pt ) {#1};
	\def\dimd{\numexpr\dim-1}
	\pgfmathsetmacro{\colo}{\xoff*10}
	\foreach \xn in {0,...,\dimd} {
		\pgfmathsetmacro{\y}{\yoff*\xn-(\dim-1)*\yoff/2}
		\node[neuron,fill=#4!\colo] (#1-\xn) at (\xoff,\y) {$h_\xn$};
		}
}


\newcommand*{\getlength}[2]{\pgfmathsetmacro#1{round(3.51459804*#2)/100.0}}



\newcommand{\gettikzxy}[3]{%
	\tikz@scan@one@point\pgfutil@firstofone#1\relax
	\edef#2{\the\pgf@x}%
	\edef#3{\the\pgf@y}%
}

\newcommandx{\nnfull}[2][]{%
	\gettikzxy{(#1)}{\ddd}{\ddd}
	\getlength{\dimu}{\ddd}
	\node (#1) {\dimu};
	\gettikzxy{(#2)}{\ddd}{\ddd}
	\getlength{\dimd}{\ddd}
	\node (#2) {\dimd};
	\pgfmathtruncatemacro{\dimeu}{\dimu-1}
	\pgfmathtruncatemacro{\dimed}{\dimd}
	
	\foreach \source in {0,...,2}{
		\foreach \dest in {0,...,2}
		{
			\path (#1-\source) edge[thick] (#2-\dest);
		}
	}
}
